!function(t){"use strict";t.fn.fieldsetDuplication=function(e){var i={prepend:!1,buttonAdd:"+",buttonRemove:"&times;",widgetSelector:".widget"};return t(this).each(function(n,a){var o=t(this),d=null,l=null,r=null,s=0,u=t.extend({},i,e,o.data("fieldset-duplication-config")||{}),c=o.attr("class").split(/\s+/);t.each(c,function(t,e){if(e.match(/duplicate-fieldset-/))return l="."+e,!1}),t.each(c,function(t,e){if(e.match(/duplicate-fieldset-maxRows-/))return r=e.substring(27),!1});var f=function(){(d=t(l)).each(function(e,i){var n=t(this);n.removeClass("last"),n.removeClass("first"),0==e&&n.addClass("first"),e==d.length-1&&n.addClass("last"),h(n),n.hasClass("duplicate")?n.find(".duplication-buttons button.duplication-button--remove").show():n.find(".duplication-buttons button.duplication-button--remove").hide()})},p=function(e){if(null!=r&&d.length>=r){t(document).trigger("fieldset-clone-rejected",[e,d,r]);return}var i=e.clone();s++;let n={};i.find("input[name], select[name], textarea[name]").each(function(){var i=t(this);i.removeClass("error");var a=i.attr("id");if(void 0!==a){var o=a.indexOf("_duplicate_");o>=0&&(a=a.substr(0,o));var d=a+"_duplicate_"+s;i.closest(u.widgetSelector).find('label[for="'+i.attr("id")+'"]').each(function(){var e=t(this);e.attr("for",d),void 0!==e.attr("id")&&e.attr("id",e.attr("id")+"_duplicate_"+s)}),i.attr("id",d)}var l=i.attr("name");if(void 0!==l){var r=l.endsWith("[]");r&&(l=l.substring(0,l.length-2));var o=l.indexOf("_duplicate_");o>=0&&(l=l.substr(0,o));var c=l+"_duplicate_"+s;r&&(c+="[]"),i.attr("name",c),n[l]=c}var f=i.attr("value");"checkbox"!==i.attr("type")&&"radio"!==i.attr("type")?i.val()&&e.hasClass("duplicate-fieldset-donotcopy")&&i.val(f):i.not("[checked]").prop("checked",!1)}),i.find("fieldset[data-cff-condition]").each((t,e)=>{let i=e.dataset.cffCondition;for(let[a,o]of Object.entries(n))i=i.replaceAll(a,o);e.dataset.cffCondition=i}),i.find("label").removeClass("error"),i.find("p.error").remove(),i.find(u.widgetSelector).removeClass("error"),i.addClass("duplicate"),b(i),e.after(i),f(),null!=r&&d.length>=r&&d.each(function(e,i){var n=t(this);n.find(".duplication-button--add").addClass("disabled"),n.find(".duplication-button--add").attr("disabled","disabled")}),t(document).trigger("fieldset-cloned",[i])},v=function(t){d.length>1&&t.hasClass("duplicate")&&(t.remove(),f())},b=function(e){e.find(".duplication-buttons button.duplication-button--add").off("click").on("click",function(e){return e.preventDefault(),p(t(this).closest("fieldset")),!1}),e.hasClass("duplicate")&&e.find(".duplication-buttons button.duplication-button--remove").off("click").on("click",function(e){return e.preventDefault(),v(t(this).closest("fieldset")),!1})},h=function(e){e.find(".duplication-buttons").remove();var i=t('<div class="duplication-buttons"></div>'),n=t('<button type="button" class="duplication-button duplication-button--add">'+u.buttonAdd+"</button>");i.append(n);var a=t('<button type="button" class="duplication-button duplication-button--remove">'+u.buttonRemove+"</button>");i.append(a),u.prepend?e.prepend(i):e.append(i),b(e)};f()}),this}}(jQuery);