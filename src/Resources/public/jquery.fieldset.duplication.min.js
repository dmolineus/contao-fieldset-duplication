!function(t){"use strict";t.fn.fieldsetDuplication=function(e){var n={prepend:!1,buttonAdd:"+",buttonRemove:"&times;",widgetSelector:".widget"};return t(this).each((function(i,a){var o=t(this),d=null,l=null,c=null,u=0,r=t.extend({},n,e,o.data("fieldset-duplication-config")||{}),s=o.attr("class").split(/\s+/);t.each(s,(function(t,e){if(e.match(/duplicate-fieldset-/))return l="."+e,!1})),t.each(s,(function(t,e){if(e.match(/duplicate-fieldset-maxRows-/))return c=e.substring("duplicate-fieldset-maxRows-".length),!1}));const f=Array.from(document.querySelectorAll(l+' [name*="_duplicate_"]')).pop();f&&(u=parseInt(f.getAttribute("name").slice(-1),10));var p=function(){(d=t(l)).each((function(e,n){var i=t(this);i.removeClass("last"),i.removeClass("first"),0==e&&i.addClass("first"),e==d.length-1&&i.addClass("last"),v(i),i.hasClass("duplicate")?i.find(".duplication-buttons button.duplication-button--remove").show():i.find(".duplication-buttons button.duplication-button--remove").hide()}))},b=function(e){e.find(".duplication-buttons button.duplication-button--add").off("click").on("click",(function(e){return e.preventDefault(),function(e){if(null!=c&&d.length>=c)return void t(document).trigger("fieldset-clone-rejected",[e,d,c]);var n=e.clone();u++;const i={};n.find("input[name], select[name], textarea[name]").each((function(){var n=t(this);n.removeClass("error");var a=n.attr("id");if(void 0!==a){(l=a.indexOf("_duplicate_"))>=0&&(a=a.substr(0,l));var o=a+"_duplicate_"+u;n.closest(r.widgetSelector).find('label[for="'+n.attr("id")+'"]').each((function(){var e=t(this);e.attr("for",o),void 0!==e.attr("id")&&e.attr("id",e.attr("id")+"_duplicate_"+u)})),n.attr("id",o)}var d=n.attr("name");if(void 0!==d){var l,c=d.endsWith("[]");c&&(d=d.substring(0,d.length-2)),(l=d.indexOf("_duplicate_"))>=0&&(d=d.substr(0,l));var s=d+"_duplicate_"+u;c&&(s+="[]"),n.attr("name",s),i[d]=s}var f=n.attr("value");"checkbox"!==n.attr("type")&&"radio"!==n.attr("type")?n.val()&&e.hasClass("duplicate-fieldset-donotcopy")&&n.val(f):n.not("[checked]").prop("checked",!1)})),n.find("fieldset[data-cff-condition]").each(((t,e)=>{let n=e.dataset.cffCondition;for(const[t,e]of Object.entries(i))n=n.replaceAll(t,e);e.dataset.cffCondition=n})),n.find("label").removeClass("error"),n.find("p.error").remove(),n.find(r.widgetSelector).removeClass("error"),n.addClass("duplicate"),b(n),e.after(n),p(),null!=c&&d.length>=c&&d.each((function(e,n){var i=t(this);i.find(".duplication-button--add").addClass("disabled"),i.find(".duplication-button--add").attr("disabled","disabled")})),t(document).trigger("fieldset-cloned",[n])}(t(this).closest("fieldset")),!1})),e.hasClass("duplicate")&&e.find(".duplication-buttons button.duplication-button--remove").off("click").on("click",(function(e){return e.preventDefault(),function(t){d.length>1&&t.hasClass("duplicate")&&(t.remove(),p())}(t(this).closest("fieldset")),!1}))},v=function(e){e.find(".duplication-buttons").remove();var n=t('<div class="duplication-buttons"></div>'),i=t('<button type="button" class="duplication-button duplication-button--add">'+r.buttonAdd+"</button>");n.append(i);var a=t('<button type="button" class="duplication-button duplication-button--remove">'+r.buttonRemove+"</button>");n.append(a),r.prepend?e.prepend(n):e.append(n),b(e)};p()})),this}}(jQuery);